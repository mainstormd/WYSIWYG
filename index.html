<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>JavaScript-инженер</title>
    <link rel="stylesheet" href="./styles/editor.css" />
    <link rel="stylesheet" href="./styles/page.css" />
  </head>
  <body>
    <div class="container">
      <main class="papercard">
        <div class="editor">
          <div class="edit-area" placeholder="Type something..." contenteditable="true"></div>
          <div class="toolkit">
            <button class="head-1" data-command="h1">
              <img src="assets/icons_h1.svg" alt="Head 1 button icon" />
            </button>
            <button class="head-2" data-command="h2">
              <img src="assets/icons_h2.svg" alt="Head 2 button icon" />
            </button>
            <button class="bold" data-command="bold">
              <img src="assets/icons_bold.svg" alt="Bold button icon" />
            </button>
            <button class="italic" data-command="italic">
              <img src="assets/icons_italic.svg" alt="Italic button icon" />
            </button>
          </div>
        </div>
      </main>
      <footer>
        <p class="authority">
          <b>Disgned</b> by
          <a href="https://dribbble.com/yaroslavsamoilov" target="_blank"
            >Yaroslav Samoilov</a
          >
        </p>
      </footer>
    </div>
    
    <script>
      let toolkitButtons = document.querySelectorAll('.toolkit button');
      
      for(let button of toolkitButtons)
       button.addEventListener('click',ToolkitButtonsClickHandler);

      var editArea = document.querySelector('.edit-area');

      editArea.addEventListener('copy', (event) => {
          const selection = document.getSelection();
          rangeSelection = selection.getRangeAt(0); 

          var contents = rangeSelection.cloneContents()
          var editArea = document.querySelector('.edit-area');
          var element = document.createElement('div')
          element.style.content = "hidden";
          element.append(contents);
          editArea.append(element);
          var s = element.getElementsByTagName('div');

          for( item of s )
              item.style.fontSize = window.getComputedStyle(item).getPropertyValue("font-size");

          event.clipboardData.setData("text/html", element.innerHTML)
          event.clipboardData.setData("text/plain", element.textContent);
          this.editArea.removeChild(element);
          event.preventDefault();
      });

      function ToolkitButtonsClickHandler()
      {
        let command = this.dataset.command ;

        if(command == 'h1' || command == 'h2')
        {
          let selection = window.getSelection();
          if(selection != "") 
          {
            var rangeSelection = selection.getRangeAt(0);
            var node = document.createElement('div');

            node.classList.add(command == "h1" ? 'header1-text' : 'header2-text');
            node.append(rangeSelection.cloneContents());
            
            rangeSelection.deleteContents();
            rangeSelection.insertNode(node);
          }
          else 
            document.execCommand('formatBlock', false, command);
        }
        
        if(command == 'bold' || command == 'italic')
          document.execCommand(command, false, null);
      }
     /*
      var s = document.getSelection().getRangeAt(0)
      var contents = s.cloneContents()
      var editArea = document.querySelector('.edit-area');
      var element = document.createElement('div')
      element.append(contents)
      editArea.append(element)

      s.forEach((item) =>{ 
        if(item.nodeName != "#text")
        {
          item.style.fontSize = window.getComputedStyle(item).getPropertyValue("font-size");
        }
      })*/
    </script>

  </body>
</html>


